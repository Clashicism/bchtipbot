import requests


RATE_API = 'https://www.bitcoin.com/special/rates.json'
CURRENCY_CODE = {
    'BTC': 0,
    'BCH_BTC': 1,
    'USD': 2,
    'EUR': 3,
    'GBP': 4,
    'JPY': 5,
    'CAD': 6,
    'AUD': 7,
    'CNY': 8,
    'CHF': 9,
    'SEK': 10,
    'NZD': 11,
    'KRW': 12,
    'ETH': 13,
    'XRP': 14,
    'AED': 15,
    'AFN': 16,
    'ALL': 17,
    'AMD': 18,
    'ANG': 19,
    'AOA': 20,
    'ARS': 21,
    'AWG': 22,
    'AZN': 23,
    'BAM': 24,
    'BBD': 25,
    'BDT': 26,
    'BGN': 27,
    'BHD': 28,
    'BIF': 29,
    'BMD': 30,
    'BND': 31,
    'BOB': 32,
    'BRL': 33,
    'BSD': 34,
    'BTN': 35,
    'BWP': 36,
    'BYN': 37,
    'BZD': 38,
    'CDF': 39,
    'CLF': 40,
    'CLP': 41,
    'COP': 42,
    'CRC': 43,
    'CUP': 44,
    'CVE': 45,
    'CZK': 46,
    'DJF': 47,
    'DKK': 48,
    'DOP': 49,
    'DZD': 50,
    'EGP': 51,
    'ETB': 52,
    'FJD': 53,
    'FKP': 54,
    'GEL': 55,
    'GHS': 56,
    'GIP': 57,
    'GMD': 58,
    'GNF': 59,
    'GTQ': 60,
    'GUSD': 61,
    'GYD': 62,
    'HKD': 63,
    'HNL': 64,
    'HRK': 65,
    'HTG': 66,
    'HUF': 67,
    'IDR': 68,
    'ILS': 69,
    'INR': 70,
    'IQD': 71,
    'IRR': 72,
    'ISK': 73,
    'JEP': 74,
    'JMD': 75,
    'JOD': 76,
    'KES': 77,
    'KGS': 78,
    'KHR': 79,
    'KMF': 80,
    'KPW': 81,
    'KWD': 82,
    'KYD': 83,
    'KZT': 84,
    'LAK': 85,
    'LBP': 86,
    'LKR': 87,
    'LRD': 88,
    'LSL': 89,
    'LYD': 90,
    'MAD': 91,
    'MDL': 92,
    'MGA': 93,
    'MKD': 94,
    'MMK': 95,
    'MNT': 96,
    'MOP': 97,
    'MRU': 98,
    'MUR': 99,
    'MVR': 100,
    'MWK': 101,
    'MXN': 102,
    'MYR': 103,
    'MZN': 104,
    'NAD': 105,
    'NGN': 106,
    'NIO': 107,
    'NOK': 108,
    'NPR': 109,
    'OMR': 110,
    'PAB': 111,
    'PAX': 112,
    'PEN': 113,
    'PGK': 114,
    'PHP': 115,
    'PKR': 116,
    'PLN': 117,
    'PYG': 118,
    'QAR': 119,
    'RON': 120,
    'RSD': 121,
    'RUB': 122,
    'RWF': 123,
    'SAR': 124,
    'SBD': 125,
    'SCR': 126,
    'SDG': 127,
    'SGD': 128,
    'SHP': 129,
    'SLL': 130,
    'SOS': 131,
    'SRD': 132,
    'STN': 133,
    'SVC': 134,
    'SYP': 135,
    'SZL': 136,
    'THB': 137,
    'TJS': 138,
    'TMT': 139,
    'TND': 140,
    'TOP': 141,
    'TRY': 142,
    'TTD': 143,
    'TWD': 144,
    'TZS': 145,
    'UAH': 146,
    'UGX': 147,
    'USDC': 148,
    'UYU': 149,
    'UZS': 150,
    'VEF': 151,
    'VES': 152,
    'VND': 153,
    'VUV': 154,
    'WST': 155,
    'XAF': 156,
    'XCD': 157,
    'XOF': 158,
    'XPF': 159,
    'YER': 160,
    'ZAR': 161,
    'ZMW': 162,
    'ZWL': 163,
    'XAG': 164,
    'XAU': 165,
    # 'BCC': 166,
    'BCH': 167,
}


def get_rate(update, currency='USD'):
    """ Returns the BCH price fetching Bitcoin.com API """
    if currency not in CURRENCY_CODE:
        return update.message.reply_text(f'{currency} is not a supported '
                                         'currency.')
    r = requests.get(RATE_API)
    if r.status_code != 200:
        return update.message.reply_text(f'Unable to contact {RATE_API}')
    data = r.json()
    # Note: data[1]['rate'] is BTC/BCH ratio
    return data[CURRENCY_CODE[currency]]['rate'] / data[1]['rate']
